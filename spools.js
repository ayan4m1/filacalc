"use strict";(self.webpackChunkfilacalc=self.webpackChunkfilacalc||[]).push([[15],{99304:function(e,n,t){t.r(n),t.d(n,{default:function(){return V}});var r=t(70885),a=t(4942),s=t(83863),i=t(38779),l=t(12902),o=t(51436),c=t(17625),d=t(64809),u=t(38485),h=t(35823),m=t.n(h),x=t(67294),f=t(34051),j=t(31555),p=t(39267),g=t(43489),b=t(2086),Z=t(77104),y=t(75147),C=t(27977),v=t(51479),S=t(64593),k=t(44586),N=t(52394),w=t(45697),L=t.n(w),P=t(65694),W=t(9198),D=t.n(W),F=t(21881),M=t(23314),O=t(48903),G=t(85893);function A(e){var n=e.form,t=n.values,r=n.handleChange,a=n.handleSubmit,i=n.setFieldValue,o=e.onHide,c=(0,x.useCallback)((function(e){i("color",e.hex)}),[i]);return(0,G.jsx)(F.Z,{dialogClassName:"modal-90w",onHide:o,show:!0,children:(0,G.jsxs)(M.Z,{onSubmit:a,children:[(0,G.jsx)(F.Z.Header,{closeButton:!0,children:(0,G.jsxs)(F.Z.Title,{children:[t?"Edit":"Create"," a Spool"]})}),(0,G.jsxs)(F.Z.Body,{children:[(0,G.jsxs)(M.Z.Group,{children:[(0,G.jsx)(M.Z.Label,{children:"Spool Name"}),(0,G.jsx)(M.Z.Control,{name:"name",onChange:r,type:"text",value:t.name})]}),(0,G.jsxs)(M.Z.Group,{children:[(0,G.jsx)(M.Z.Label,{children:"Filament Material"}),(0,G.jsxs)(M.Z.Select,{name:"material",onChange:r,value:t.material,children:[O.NC.map((function(e){return(0,G.jsx)("option",{value:e.name,children:e.name},e.name)})),(0,G.jsx)("option",{value:"custom",children:"Custom"})]})]}),"custom"===t.material&&(0,G.jsxs)(M.Z.Group,{children:[(0,G.jsxs)(M.Z.Label,{children:["Material Density (g/cm",(0,G.jsx)("sup",{children:"3"}),")"]}),(0,G.jsx)(M.Z.Control,{name:"materialDensity",onChange:r,type:"number",value:t.materialDensity})]}),(0,G.jsxs)(M.Z.Group,{children:[(0,G.jsx)(M.Z.Label,{children:"Color"}),(0,G.jsx)(M.Z.Control,{name:"color",onChange:r,type:"text",value:t.color}),(0,G.jsx)(P.xS,{className:"my-2",color:t.color,onChange:c})]}),(0,G.jsxs)(M.Z.Group,{children:[(0,G.jsx)(M.Z.Label,{children:"Net Weight (g)"}),(0,G.jsx)(M.Z.Control,{min:"0",name:"netWeight",onChange:r,type:"number",value:t.netWeight})]}),(0,G.jsxs)(M.Z.Group,{children:[(0,G.jsx)(M.Z.Label,{children:"Spool Weight (g)"}),(0,G.jsx)(M.Z.Control,{min:"0",name:"spoolWeight",onChange:r,type:"number",value:t.spoolWeight})]}),(0,G.jsxs)(M.Z.Group,{children:[(0,G.jsx)(M.Z.Label,{children:"Current Weight (g)"}),(0,G.jsx)(M.Z.Control,{min:"0",name:"currentWeight",onChange:r,step:"0.01",type:"number",value:t.currentWeight}),(0,G.jsxs)(M.Z.Text,{className:"text-primary",children:[((t.currentWeight-t.spoolWeight)/t.netWeight*100).toFixed(2),"% remaining"]})]}),(0,G.jsxs)(M.Z.Group,{children:[(0,G.jsx)(M.Z.Label,{children:"Filameter Diameter (mm)"}),(0,G.jsx)(M.Z.Control,{min:"0",name:"filamentDiameter",onChange:r,type:"text",value:t.filamentDiameter})]}),(0,G.jsxs)(M.Z.Group,{children:[(0,G.jsx)(M.Z.Label,{children:"Purchase Date"}),(0,G.jsx)(M.Z.Control,{as:D(),onChange:function(e){return i("purchaseDate",(0,s.Z)(e))},selected:(0,l.default)(t.purchaseDate)})]})]}),(0,G.jsxs)(F.Z.Footer,{children:[(0,G.jsx)(Z.Z,{onClick:o,variant:"secondary",children:"Cancel"}),(0,G.jsx)(Z.Z,{type:"submit",variant:"primary",children:"Save"})]})]})})}A.propTypes={form:L().shape({values:L().object,setFieldValue:L().func.isRequired,handleChange:L().func.isRequired,handleSubmit:L().func.isRequired}).isRequired,onHide:L().func.isRequired};var R=t(10682),H=t(36968),E=t(70256);function T(e){var n=e.spool,t=e.onHide,r=e.onSubmit,a=(0,u.TA)({initialValues:{filamentLength:0,copies:1},validate:(0,x.useCallback)((function(e){var t={};e.copies<1&&(t.copies="Copies must be greater than zero.");var r=(0,O.Hk)(n).length;return e.filamentLength<=0?t.filamentLength="Filament length must be greater than zero.":e.filamentLength>r&&(t.filamentLength="Filament length must be less than ".concat(r.toFixed(2)," meters.")),t}),[n]),onSubmit:(0,x.useCallback)((function(e){var t=0,a=e.filamentLength*e.copies,s=Math.PI*Math.pow(n.filamentDiameter/2,2)*a;t="custom"!==n.material?s*(0,O.Ut)(n.material).density:s*n.materialDensity,r(t)}),[r,n])}),s=a.errors,i=a.values,l=a.handleChange,o=a.handleSubmit,c=a.setFieldValue,d=(0,E.Z)((function(e){return c("filamentLength",e.length.toFixed(2))})),h=d.loading,m=d.error,p=d.progress,g=d.handleChange;return h?(0,G.jsxs)(F.Z,{onHide:t,show:!0,children:[(0,G.jsx)(F.Z.Header,{children:(0,G.jsx)(F.Z.Title,{children:"Parsing your G-code..."})}),(0,G.jsx)(F.Z.Body,{children:(0,G.jsx)(R.Z,{children:(0,G.jsx)(f.Z,{children:(0,G.jsxs)(j.Z,{className:"text-center mb-4",children:[(0,G.jsx)(H.Z,{animation:"border",className:"my-3"}),(0,G.jsx)(v.Z,{animated:!0,now:p,variant:"primary"})]})})})})]}):(0,G.jsx)(F.Z,{onHide:t,show:!0,children:(0,G.jsxs)(M.Z,{children:[(0,G.jsx)(F.Z.Header,{closeButton:!0,children:(0,G.jsxs)(F.Z.Title,{children:["Print from ",null==n?void 0:n.name]})}),(0,G.jsxs)(F.Z.Body,{children:[(0,G.jsxs)(M.Z.Group,{children:[(0,G.jsx)(M.Z.Label,{children:"Select a G-code file"}),(0,G.jsx)(M.Z.Control,{isInvalid:m,onChange:g,type:"file"}),(0,G.jsx)(M.Z.Text,{className:"text-muted",children:"Files are parsed in your browser, not sent to a server."}),(0,G.jsx)(M.Z.Control.Feedback,{type:"invalid",children:"Unable to parse the selected file."})]}),(0,G.jsxs)(M.Z.Group,{children:[(0,G.jsx)(M.Z.Label,{children:"Filament Length (m)"}),(0,G.jsx)(M.Z.Control,{isInvalid:Boolean(s.filamentLength),min:"0",name:"filamentLength",onChange:l,type:"number",value:i.filamentLength}),(0,G.jsx)(M.Z.Control.Feedback,{type:"invalid",children:s.filamentLength})]}),(0,G.jsxs)(M.Z.Group,{children:[(0,G.jsx)(M.Z.Label,{children:"Number of Copies"}),(0,G.jsx)(M.Z.Control,{isInvalid:Boolean(s.copies),min:"1",name:"copies",onChange:l,type:"number",value:i.copies}),(0,G.jsx)(M.Z.Control.Feedback,{type:"invalid",children:s.filamentLength})]})]}),(0,G.jsxs)(F.Z.Footer,{children:[(0,G.jsx)(Z.Z,{onClick:t,variant:"secondary",children:"Cancel"}),(0,G.jsx)(Z.Z,{onClick:o,variant:"primary",children:"Print"})]})]})})}function B(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function q(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?B(Object(t),!0).forEach((function(n){(0,a.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):B(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}T.propTypes={onHide:L().func.isRequired,onSubmit:L().func.isRequired,spool:L().object.isRequired};var I=(0,x.forwardRef)((function(e,n){return(0,G.jsx)(c.G,q({forwardedRef:n},e))}));function V(){var e={name:"Spool",material:"PLA",materialDensity:1.24,color:"#000000",netWeight:1e3,spoolWeight:250,currentWeight:1250,filamentDiameter:1.75,purchaseDate:(0,s.Z)(new Date)},n=(0,x.useRef)(),t=(0,x.useState)(null),a=(0,r.Z)(t,2),h=a[0],w=a[1],L=(0,x.useState)(!1),P=(0,r.Z)(L,2),W=P[0],D=P[1],F=(0,x.useState)(!1),M=(0,r.Z)(F,2),R=M[0],H=M[1],E=(0,x.useState)(0),B=(0,r.Z)(E,2),V=B[0],U=B[1],z=(0,x.useState)(0),K=(0,r.Z)(z,2),J=K[0],Q=K[1],Y=(0,N.K)(),$=Y.spools,X=Y.findSpool,_=Y.addSpool,ee=Y.updateSpool,ne=Y.removeSpool,te=Y.setSpools,re=(0,u.TA)({initialValues:e,onSubmit:function(e){h?ee(q({id:h},e)):_(q({id:(0,k.Z)()},e)),D(!1)}}),ae=re.handleReset,se=re.setFieldValue,ie=(0,x.useCallback)((function(){ae(),D(!0),w(null)}),[D,w,ae]),le=(0,x.useCallback)((function(){if(h){var e=X(h);for(var n in e)Object.hasOwn(e,n)&&se(n,e[n]);D(!0)}}),[D,se,X,h]),oe=(0,x.useCallback)((function(){h&&confirm("Are you sure you want to delete this spool?")&&ne(h)}),[ne,h]),ce=(0,x.useCallback)((function(){_(q(q({},X(h)),{},{id:(0,k.Z)()}))}),[_,X,h]),de=(0,x.useCallback)((function(){h&&H(!0)}),[h,H]),ue=(0,x.useCallback)((function(e){if(h){var n=X(h),t=Math.round(100*(n.currentWeight-e))/100;ee(q(q({},n),{},{currentWeight:t})),H(!1)}}),[X,ee,h]),he=(0,x.useCallback)((function(){n.current&&n.current.click()}),[n]),me=(0,x.useCallback)((function(e){var n=(0,r.Z)(e.target.files,1)[0],t=new FileReader;t.onloadend=function(e){var n=e.target.result,t=JSON.parse(n);t&&(w(null),te(t))},t.readAsText(n)}),[w,te]),xe=(0,x.useCallback)((function(){return m()(JSON.stringify($),"filacalc-export-".concat((0,i.default)(Date.now(),"yyyy-MM-dd"),".json"))}),[$]),fe=(0,x.useCallback)((function(){confirm("Are you sure you want to cancel?")&&D(!1)}),[D]),je=(0,x.useCallback)((function(){return H(!1)}),[H]),pe=(0,x.useCallback)((function(e){return w((function(n){return n===e?null:e}))}),[w]);return(0,x.useEffect)((function(){U($.reduce((function(e,n){return e+n.netWeight}),0)),Q($.reduce((function(e,n){return e+(n.currentWeight-n.spoolWeight)}),0))}),[U,Q,$]),(0,G.jsxs)(x.Fragment,{children:[(0,G.jsx)(S.q,{title:"Spool Database"}),W&&(0,G.jsx)(A,{form:re,onHide:fe,show:W}),h&&R&&(0,G.jsx)(T,{onHide:je,onSubmit:ue,spool:X(h)}),(0,G.jsxs)(f.Z,{className:"mb-2",children:[(0,G.jsx)(j.Z,{md:9,children:(0,G.jsxs)("div",{className:"d-flex align-items-center",children:[(0,G.jsx)("h1",{className:"me-2",children:"Spool Database"}),(0,G.jsx)(p.Z,{overlay:(0,G.jsx)(g.Z,{children:"All data is saved to your browser's local storage."}),placement:"right",children:(0,G.jsx)(I,{icon:o.Fuz})})]})}),(0,G.jsxs)(j.Z,{className:"d-flex justify-content-end align-items-end",md:3,children:[(0,G.jsx)("input",{className:"d-none",onChange:me,ref:n,type:"file"}),(0,G.jsxs)(b.Z,{children:[(0,G.jsxs)(Z.Z,{onClick:he,children:[(0,G.jsx)(c.G,{icon:o.cf$})," Import"]}),(0,G.jsxs)(Z.Z,{onClick:xe,children:[(0,G.jsx)(c.G,{icon:o.q7m})," Export"]})]})]})]}),(0,G.jsxs)("div",{className:"d-flex mb-2",children:[(0,G.jsxs)(b.Z,{children:[(0,G.jsxs)(Z.Z,{onClick:ie,variant:"success",children:[(0,G.jsx)(c.G,{icon:o.KtF})," Add"]}),(0,G.jsxs)(Z.Z,{disabled:!h,onClick:le,children:[(0,G.jsx)(c.G,{icon:o.TzT})," Edit"]}),(0,G.jsxs)(Z.Z,{disabled:!h,onClick:ce,children:[(0,G.jsx)(c.G,{icon:o.WM4})," Clone"]}),(0,G.jsxs)(Z.Z,{disabled:!h,onClick:oe,variant:"danger",children:[(0,G.jsx)(c.G,{icon:o.$aW})," Remove"]})]}),(0,G.jsx)(b.Z,{className:"ms-auto",children:(0,G.jsxs)(Z.Z,{disabled:!h,onClick:de,children:[(0,G.jsx)(c.G,{icon:o.wf8})," Print"]})})]}),(0,G.jsxs)(y.Z,{children:[(0,G.jsxs)("thead",{children:[(0,G.jsxs)("tr",{children:[(0,G.jsx)("th",{colSpan:4}),(0,G.jsx)("th",{className:"text-center",colSpan:3,children:"Remaining"})]}),(0,G.jsxs)("tr",{children:[(0,G.jsx)("th",{style:{width:"30%"},children:"Name"}),(0,G.jsx)("th",{children:"Material"}),(0,G.jsx)("th",{className:"text-center",children:"Purchased"}),(0,G.jsx)("th",{className:"text-end",children:"Net Weight"}),(0,G.jsx)("th",{className:"text-end",style:{width:"20%"},children:"%"}),(0,G.jsx)("th",{className:"text-end",children:"Mass"}),(0,G.jsx)("th",{className:"text-end",children:"Length"})]})]}),(0,G.jsxs)("tbody",{children:[!(null!=$&&$.length)&&(0,G.jsx)("tr",{children:(0,G.jsx)("td",{colSpan:7,children:"No spools."})}),$.map((function(e){var n=(0,O.Hk)(e),t=n.mass,r=n.length;return(0,G.jsxs)("tr",{className:h===e.id?"bg-dark text-light":"",onClick:function(){return pe(e.id)},children:[(0,G.jsx)("td",{children:(0,G.jsx)(C.Z,{bg:"",style:{color:(0,d.Qg)(e.color),backgroundColor:e.color},children:e.name})}),(0,G.jsx)("td",{children:e.material}),(0,G.jsx)("td",{className:"text-center",children:Boolean(e.purchaseDate)&&(0,i.default)((0,l.default)(e.purchaseDate),"yyyy-MM-dd")}),(0,G.jsxs)("td",{className:"text-end",children:[e.netWeight," g"]}),(0,G.jsx)("td",{className:"text-end",children:(0,G.jsx)(v.Z,{className:"text-light",label:"".concat(Math.floor(t/e.netWeight*100),"%"),now:t/e.netWeight*100})}),(0,G.jsxs)("td",{className:"text-end",children:[t.toFixed(2)," g"]}),(0,G.jsxs)("td",{className:"text-end",children:[r.toFixed(2)," m"]})]},e.id)}))]}),(0,G.jsx)("tfoot",{children:(0,G.jsxs)("tr",{children:[(0,G.jsx)("td",{children:"Totals"}),(0,G.jsxs)("td",{className:"text-end",colSpan:3,children:[Math.round(V)," g"]}),(0,G.jsxs)("td",{className:"text-end",colSpan:2,children:[Math.round(J)," g"]}),(0,G.jsx)("td",{})]})})]})]})}I.displayName="Icon"},70256:function(e,n,t){t.d(n,{Z:function(){return l}});var r=t(70885),a=t(67294),s=()=>{const e=e=>{for(const[,,,n,t]of[...e.trim().matchAll(/(\s*(([XYZFEIJR])([0-9\-.]+))\s*)/g)])if("E"===n)return parseFloat(t);return 0};self.addEventListener("message",(({data:n})=>{const t=new FileReader;let r=0,a=0;t.addEventListener("load",(n=>{const t=n.target.result.split(/[\n]/g).filter((e=>/^G[1-3]/.test(e)));for(const[n,s]of t.entries()){r+=e(s);const i=Math.round(n/t.length*100);i!==a&&(postMessage({type:"progress",progress:i}),a=i)}r>0&&postMessage({type:"result",length:r/1e3})})),t.addEventListener("error",(()=>{postMessage({type:"error"})})),t.readAsText(n)}))},i=t(48903);function l(e){var n=(0,a.useMemo)((function(){return(0,i.j1)(s)}),[]),t=(0,a.useState)(!1),l=(0,r.Z)(t,2),o=l[0],c=l[1],d=(0,a.useState)(!1),u=(0,r.Z)(d,2),h=u[0],m=u[1],x=(0,a.useState)(0),f=(0,r.Z)(x,2),j=f[0],p=f[1],g=(0,a.useCallback)((function(n){var t=n.data;switch(t.type){case"progress":p(t.progress);break;case"result":e(t),m(!1),p(100);break;case"error":c(!0),m(!1)}}),[e,p,m,c]),b=(0,a.useCallback)((function(e){var t=(0,r.Z)(e.target.files,1)[0];if(!t||!t.name.endsWith(".gcode"))return c(!0),void m(!1);c(!1),m(!0),p(0),n.postMessage(t)}),[n]);return(0,a.useEffect)((function(){return n.addEventListener("message",g),function(){return n.removeEventListener("message",g)}})),{loading:h,error:o,progress:j,handleChange:b}}},48903:function(e,n,t){t.d(n,{AF:function(){return d},Hk:function(){return f},Kl:function(){return m},NC:function(){return l},OK:function(){return c},Q:function(){return h},Ut:function(){return o},ZM:function(){return s},bA:function(){return u},j1:function(){return a},lO:function(){return x},w5:function(){return i}});var r=t(71002),a=function(e){if("object"===("undefined"==typeof window?"undefined":(0,r.Z)(window))){var n=e.toString(),t=new Blob(["(".concat(n,")()")]);return new Worker(URL.createObjectURL(t))}},s=[{brand:"3D Solutech",mass:173},{brand:"Amazon Basics",mass:248},{brand:"Amolen",mass:190},{brand:"Atomic Filament",mass:306},{brand:"Colorfabb",mass:236},{brand:"eSun",mass:224},{brand:"Inland",mass:225},{brand:"Hatchbox",mass:225},{brand:"Overture",mass:237},{brand:"PolyMaker",mass:220},{brand:"Prusament",mass:201},{brand:"ProtoPasta",mass:70},{brand:"StrongHero3D",mass:151},{brand:"SunLu",mass:133},{brand:"ZYLtech",mass:179}],i=function(e){return s.find((function(n){return n.brand===e}))},l=[{name:"PLA",density:1.24},{name:"ABS",density:1.04},{name:"PETG",density:1.27},{name:"Nylon",density:1.52},{name:"TPU",density:1.21},{name:"PC",density:1.3},{name:"CF",density:1.3},{name:"HIPS",density:1.03},{name:"PVA",density:1.23},{name:"ASA",density:1.05},{name:"PP",density:.9},{name:"POM",density:1.4},{name:"PMMA",density:1.18}],o=function(e){return l.find((function(n){return n.name===e}))},c=[{name:"Mk8",diameter:2.4,length:13},{name:"Mk10",diameter:4,length:13},{name:"Volcano 1.75mm",diameter:2,length:21},{name:"Volcano 3mm",diameter:3.2,length:21}],d=function(e){return c.find((function(n){return n.name===e}))},u=[{name:"Ender 3",meltZoneDiameter:2,meltZoneLength:25},{name:"Volcano",meltZoneDiameter:6,meltZoneLength:19}],h=function(e){return u.find((function(n){return n.name===e}))},m=[1.8,.9,7.5],x=[1.25,1,12,16,25,1.41111,1.27,1.5875],f=function(e){var n=0,t=e.currentWeight-e.spoolWeight;return{mass:t,volume:n="custom"!==e.material?t/o(e.material).density:t/e.materialDensity,length:n/Math.PI/Math.pow(e.filamentDiameter/2,2),percent:t/e.netWeight*100}}}}]);